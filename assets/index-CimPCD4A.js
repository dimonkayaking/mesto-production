(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const re=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),V=(e,t,{onPreviewPicture:o,onLike:r,onDelete:n})=>{const c=re(),a=c.querySelector(".card__like-button"),u=c.querySelector(".card__control-button_type_delete"),d=c.querySelector(".card__image"),q=c.querySelector(".card__title"),y=c.querySelector(".card__like-count");return d.src=e.link,d.alt=e.name,q.textContent=e.name,y.textContent=e.likes.length,e.likes.some(s=>s._id===t)&&a.classList.add("card__like-button_is-active"),e.owner._id===t||u.remove(),a.addEventListener("click",()=>{const s=a.classList.contains("card__like-button_is-active");r(e._id,s,a,y)}),n&&u&&u.addEventListener("click",()=>{n(e._id,c)}),o&&d.addEventListener("click",()=>{o({name:e.name,link:e.link})}),c},z=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");_(t)}},h=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",z)},_=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",z)},ce=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{_(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&_(e)})},N=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},K=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},se=(e,t,o)=>{if(t.validity.patternMismatch){const r=t.dataset.errorMessage;N(e,t,r,o)}else t.validity.valid?K(e,t,o):N(e,t,t.validationMessage,o)},le=e=>e.some(t=>!t.validity.valid),R=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},ie=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},A=(e,t,o)=>{le(e)?R(t,o):ie(t,o)},ae=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{se(e,n,t),A(o,r,t)})})},x=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{K(e,n,t)}),R(r,t)},ue=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ae(o,e)})},l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"76e3b2ad-0958-44f5-9f54-498cf537e619","Content-Type":"application/json"}},f=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),pe=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(f),G=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(f),de=e=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(f),_e=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(f),me=e=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(f),fe=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(f),ye=(e,t)=>fetch(`${l.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:l.headers}).then(f),g={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let E=null;const Q=document.querySelector(".places__list"),I=document.querySelector(".popup_type_edit"),v=I.querySelector(".popup__form"),X=v.querySelector(".popup__input_type_name"),Y=v.querySelector(".popup__input_type_description"),F=v.querySelector(".popup__button"),B=document.querySelector(".popup_type_new-card"),m=B.querySelector(".popup__form"),he=m.querySelector(".popup__input_type_card-name"),Se=m.querySelector(".popup__input_type_url"),O=m.querySelector(".popup__button"),w=document.querySelector(".popup_type_image"),W=w.querySelector(".popup__image"),ve=w.querySelector(".popup__caption"),Le=document.querySelector(".profile__edit-button"),be=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),$=document.querySelector(".popup_type_edit-avatar"),L=$.querySelector(".popup__form"),qe=L.querySelector(".popup__input"),j=L.querySelector(".popup__button"),U=document.querySelector(".popup_type_remove-card"),Z=U.querySelector(".popup__form"),H=Z.querySelector(".popup__button"),b=document.querySelector(".popup_type_info"),Ce=b.querySelector(".popup__title"),S=b.querySelector(".popup__info"),ke=b.querySelector(".popup__text"),J=b.querySelector(".popup__list"),ge=document.querySelector(".header__logo");let k=null;const D=({name:e,link:t})=>{W.src=t,W.alt=e,ve.textContent=e,h(w)},p=(e,t,o,r)=>{t.textContent=e?r:o},Ee=e=>{e.preventDefault(),p(!0,F,"Сохранить","Сохранение..."),de({name:X.value,about:Y.value}).then(t=>{P.textContent=t.name,T.textContent=t.about,_(I)}).catch(t=>{console.log(t)}).finally(()=>{p(!1,F,"Сохранить","Сохранение...")})},xe=e=>{e.preventDefault(),p(!0,j,"Сохранить","Сохранение..."),_e(qe.value).then(t=>{M.style.backgroundImage=`url(${t.avatar})`,_($),L.reset()}).catch(t=>{console.log(t)}).finally(()=>{p(!1,j,"Сохранить","Сохранение...")})},Ie=e=>{e.preventDefault(),p(!0,O,"Создать","Создание..."),me({name:he.value,link:Se.value}).then(t=>{Q.prepend(V(t,E,{onPreviewPicture:D,onLike:ee,onDelete:te})),_(B),m.reset()}).catch(t=>{console.log(t)}).finally(()=>{p(!1,O,"Создать","Создание...")})},Be=e=>{e.preventDefault(),p(!0,H,"Да","Удаление..."),fe(k.id).then(()=>{k.element.remove(),_(U),k=null}).catch(t=>{console.log(t)}).finally(()=>{p(!1,H,"Да","Удаление...")})},ee=(e,t,o,r)=>{ye(e,t).then(n=>{o.classList.toggle("card__like-button_is-active"),r.textContent=n.likes.length}).catch(n=>{console.log(n)})},te=(e,t)=>{k={id:e,element:t},h(U)},we=()=>{G().then(e=>{Ce.textContent="Статистика карточек",S.innerHTML="",J.innerHTML="";const t=document.getElementById("popup-info-definition-template"),o=document.getElementById("popup-info-user-preview-template"),r=new Set;e.forEach(s=>{r.add(s.owner._id),s.likes.forEach(i=>r.add(i._id))});const n=t.content.cloneNode(!0);n.querySelector(".popup__info-term").textContent="Всего пользователей:",n.querySelector(".popup__info-description").textContent=r.size.toString(),S.append(n);const c=e.reduce((s,i)=>s+i.likes.length,0),a=t.content.cloneNode(!0);a.querySelector(".popup__info-term").textContent="Всего лайков:",a.querySelector(".popup__info-description").textContent=c.toString(),S.append(a);const u={};e.forEach(s=>{s.likes.forEach(i=>{u[i._id]||(u[i._id]={name:i.name,count:0}),u[i._id].count++})});let d=0,q="";Object.values(u).forEach(s=>{s.count>d&&(d=s.count,q=s.name)});const y=t.content.cloneNode(!0);y.querySelector(".popup__info-term").textContent="Максимально лайков от одного:",y.querySelector(".popup__info-description").textContent=d.toString(),S.append(y);const C=t.content.cloneNode(!0);C.querySelector(".popup__info-term").textContent="Чемпион лайков:",C.querySelector(".popup__info-description").textContent=q,S.append(C),ke.textContent="Популярные карточки:",[...e].sort((s,i)=>i.likes.length-s.likes.length).slice(0,3).forEach(s=>{const i=o.content.cloneNode(!0),ne=i.querySelector(".popup__list-item_type_badge");ne.textContent=`${s.name} (${s.likes.length} лайков)`,J.append(i)}),h(b)}).catch(e=>{console.log(e)})};Le.addEventListener("click",()=>{X.value=P.textContent,Y.value=T.textContent,x(v,g),h(I)});M.addEventListener("click",()=>{x(L,g),h($)});be.addEventListener("click",()=>{m.reset(),x(m,g),h(B)});ge.addEventListener("click",we);v.addEventListener("submit",Ee);m.addEventListener("submit",Ie);L.addEventListener("submit",xe);Z.addEventListener("submit",Be);Promise.all([G(),pe()]).then(([e,t])=>{E=t._id,P.textContent=t.name,T.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{Q.append(V(o,E,{onPreviewPicture:D,onLike:ee,onDelete:te}))})}).catch(e=>{console.log(e)});const Pe=document.querySelectorAll(".popup");Pe.forEach(e=>{ce(e)});ue(g);
